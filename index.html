<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹¤ì‹œê°„ ì¸í„°ë™í‹°ë¸Œ í´ë˜ìŠ¤</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FEE500; /* ì¹´ì¹´ì˜¤ ì˜ë¡œìš° */
            --primary-dark: #F3D000;
            --text-color: #3b1e1e;    /* ì¹´ì¹´ì˜¤ ë¸Œë¼ìš´ */
            --bg-color: #b2c7d9;      /* ì±„íŒ…ë°© ë°°ê²½ìƒ‰ */
            --white: #ffffff;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
        }

        /* ìœ í‹¸ë¦¬í‹°: ìˆ¨ê¹€ ì²˜ë¦¬ */
        .hidden { display: none !important; }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
        }
        .toast {
            background: rgba(59, 30, 30, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            margin-bottom: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            animation: slideDown 0.3s ease-out;
            font-size: 14px;
        }
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* 1. ë¡œê·¸ì¸ í™”ë©´ */
        .login-wrapper {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .login-card {
            background: var(--white);
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .login-card h1 { margin-bottom: 30px; font-size: 24px; }
        
        .role-tabs {
            display: flex;
            background: #eee;
            padding: 5px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        .role-tab {
            flex: 1;
            padding: 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            color: #777;
            transition: all 0.3s;
        }
        .role-tab.active {
            background: var(--white);
            color: var(--text-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .input-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .btn-primary {
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-color);
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-primary:hover { background: var(--primary-dark); }

        /* 2. ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            height: 100vh;
            padding: 20px;
            display: grid;
            grid-template-columns: 2fr 1.2fr;
            gap: 20px;
        }

        /* ì™¼ìª½: ì±„íŒ…/ì§ˆë¬¸ ì˜ì—­ */
        .left-panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 15px;
        }

        .panel-box {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        /* ì„ ìƒë‹˜ ì»¨íŠ¸ë¡¤ */
        .teacher-controls {
            background: var(--primary-color);
            border: none;
        }
        .control-row { display: flex; gap: 10px; margin-top: 10px; }
        .control-row input { flex: 1; padding: 10px; border-radius: 8px; border: none; }
        .control-row button { 
            padding: 10px 20px; 
            background: var(--text-color); 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
        }

        /* ì±„íŒ… ì˜ì—­ */
        .chat-window {
            flex: 1;
            overflow-y: auto;
            background: #abc1d1; /* ì±„íŒ…ì°½ ë‚´ë¶€ ë°°ê²½ */
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ë©”ì‹œì§€ ë²„ë¸” ìŠ¤íƒ€ì¼ */
        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 12px;
            position: relative;
            animation: fadeIn 0.3s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .message .sender {
            font-size: 12px;
            margin-bottom: 4px;
            opacity: 0.7;
        }
        .message .text {
            font-size: 15px;
            line-height: 1.4;
            word-break: break-all;
        }

        /* ì„ ìƒë‹˜ ì§ˆë¬¸ (ì¤‘ì•™) */
        .msg-teacher {
            align-self: center;
            background: var(--white);
            border: 2px solid var(--primary-color);
            width: 90%;
            max-width: 90%;
            text-align: center;
            margin-bottom: 20px;
        }
        .msg-teacher .sender { color: var(--text-color); font-weight: bold; }
        .msg-teacher .text { font-size: 18px; font-weight: bold; }

        /* ë‹¤ë¥¸ í•™ìƒ ë‹µë³€ (ì™¼ìª½) */
        .msg-other {
            align-self: flex-start;
            background: var(--white);
            border-top-left-radius: 0;
        }

        /* ë‚´ ë‹µë³€ (ì˜¤ë¥¸ìª½) */
        .msg-me {
            align-self: flex-end;
            background: var(--primary-color);
            border-top-right-radius: 0;
        }

        /* ì…ë ¥ë°” */
        .input-bar {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: var(--white);
            border-radius: 15px;
        }
        .input-bar input {
            flex: 1;
            border: none;
            background: #f0f0f0;
            padding: 12px;
            border-radius: 20px;
        }
        .input-bar button {
            background: var(--primary-color);
            border: none;
            width: 50px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 20px;
        }

        /* ì˜¤ë¥¸ìª½: í†µê³„/ì›Œë“œí´ë¼ìš°ë“œ */
        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 100%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-card {
            background: var(--white);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .stat-num { font-size: 28px; font-weight: bold; color: var(--text-color); }
        .stat-label { font-size: 12px; color: #666; }

        .wordcloud-box {
            flex: 1;
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        .wordcloud-content {
            flex: 1;
            position: relative;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 10px;
            overflow-y: auto;
            padding: 10px;
        }

        /* ì›Œë“œí´ë¼ìš°ë“œ ë‹¨ì–´ ìŠ¤íƒ€ì¼ */
        .wc-word {
            display: inline-block;
            transition: all 0.3s ease;
            cursor: default;
            font-weight: bold;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .wc-word:hover { transform: scale(1.2); z-index: 10; }
        
        .size-1 { font-size: 14px; color: #888; opacity: 0.7; }
        .size-2 { font-size: 18px; color: #666; opacity: 0.8; }
        .size-3 { font-size: 24px; color: #555; opacity: 0.9; }
        .size-4 { font-size: 32px; color: var(--text-color); opacity: 1; }
        .size-5 { font-size: 42px; color: #d9480f; opacity: 1; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }

        /* ê²½ê³  ì˜¤ë²„ë ˆì´ */
        .config-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
        }
        .config-msg {
            background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 500px;
        }

        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .main-container { grid-template-columns: 1fr; grid-template-rows: 1fr 1fr; overflow-y: auto; height: auto; }
            .right-panel { min-height: 400px; }
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="configWarning" class="config-overlay hidden">
        <div class="config-msg">
            <h2 style="color:red; margin-bottom:10px;">âš ï¸ ì„¤ì • í•„ìš”</h2>
            <p>ì½”ë“œ ë‚´ë¶€ì˜ <code>firebaseConfig</code> ê°’ì„ ë³¸ì¸ì˜ Firebase í”„ë¡œì íŠ¸ ì •ë³´ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.</p>
            <p style="margin-top:10px; font-size:12px; color:#666;">(HTML íŒŒì¼ì„ í…ìŠ¤íŠ¸ ì—ë””í„°ë¡œ ì—´ì–´ ìˆ˜ì •í•´ì£¼ì„¸ìš”)</p>
            <button onclick="location.reload()" style="margin-top:20px; padding:10px 20px;">ìƒˆë¡œê³ ì¹¨</button>
        </div>
    </div>

    <div class="login-wrapper" id="loginScreen">
        <div class="login-card">
            <h1>ğŸ“ ì‹¤ì‹œê°„ ìˆ˜ì—… ì…ì¥</h1>
            
            <div class="role-tabs">
                <button class="role-tab active" onclick="setRole('teacher')">ì„ ìƒë‹˜</button>
                <button class="role-tab" onclick="setRole('student')">í•™ìƒ</button>
            </div>

            <div id="loginForm">
                <div id="teacherInput" class="input-group">
                    <input type="password" id="pwInput" placeholder="ë¹„ë°€ë²ˆí˜¸ (teacher1234)" onkeypress="handleEnter(event, login)">
                </div>
                <div id="studentInput" class="input-group hidden">
                    <input type="text" id="nickInput" placeholder="ì‚¬ìš©í•  ë‹‰ë„¤ì„ ì…ë ¥" onkeypress="handleEnter(event, login)">
                </div>

                <button class="btn-primary" onclick="login()">ì…ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div class="main-container hidden" id="mainScreen">
        
        <div class="left-panel">
            <div id="teacherControls" class="panel-box teacher-controls hidden">
                <h3 style="margin-bottom:10px;">ğŸ“¢ ì„ ìƒë‹˜ ì§ˆë¬¸ ì œì–´íŒ</h3>
                <div class="control-row">
                    <input type="number" id="totalStudentInput" placeholder="ì „ì²´ í•™ìƒ ìˆ˜" style="max-width: 120px;">
                    <button onclick="setTotalCount()">ì¸ì› ì„¤ì •</button>
                </div>
                <div class="control-row">
                    <input type="text" id="questionInput" placeholder="í•™ìƒë“¤ì—ê²Œ ë³´ë‚¼ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event, sendQuestion)">
                    <button onclick="sendQuestion()">ì§ˆë¬¸ ì „ì†¡</button>
                </div>
            </div>

            <div class="chat-window" id="chatWindow">
                <div style="text-align:center; margin-top:50px; color:#666;">
                    ì•„ì§ ì§ˆë¬¸ì´ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br>ì„ ìƒë‹˜ì˜ ì§ˆë¬¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”. â³
                </div>
            </div>

            <div id="studentControls" class="input-bar hidden">
                <input type="text" id="answerInput" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event, sendAnswer)">
                <button onclick="sendAnswer()">â¤</button>
            </div>
        </div>

        <div class="right-panel">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-num" id="statTotal">0</div>
                    <div class="stat-label">ì „ì²´ í•™ìƒ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-num" id="statAnswered" style="color:var(--primary-color);">0</div>
                    <div class="stat-label">ì œì¶œ ì™„ë£Œ</div>
                </div>
            </div>

            <div class="wordcloud-box">
                <h3 style="margin-bottom:15px; display:flex; justify-content:space-between;">
                    â˜ï¸ í‚¤ì›Œë“œ í´ë¼ìš°ë“œ
                    <span style="font-size:12px; color:#999; font-weight:normal;">ìë™ ì—…ë°ì´íŠ¸ë¨</span>
                </h3>
                <div class="wordcloud-content" id="wordcloudContainer">
                    <p style="color:#ccc; font-size:14px;">ë‹µë³€ì´ ëª¨ì´ë©´ í‚¤ì›Œë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ==========================================
        // âš ï¸ ì¤‘ìš”: Firebase ì„¤ì •ì„ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”
        // ==========================================
        const firebaseConfig = {
    apiKey: "AIzaSyDEys1p0xD5AVlGGbMFYV5GaD6yvzlNHhY",
    authDomain: "qa-classroom.firebaseapp.com",
    databaseURL: "https://qa-classroom-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "qa-classroom",
    storageBucket: "qa-classroom.firebasestorage.app",
    messagingSenderId: "994599583786",
    appId: "1:994599583786:web:62a41f1f376688d4788353"
  }

        // ==========================================
        // ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™”
        // ==========================================
        let db;
        let currentRole = 'teacher';
        let myName = '';
        let isConfigured = false;

        // 1. ì„¤ì • ê²€ì¦ ë° Firebase ì´ˆê¸°í™”
        function initFirebase() {
            if (firebaseConfig.apiKey === "YOUR_API_KEY" || firebaseConfig.databaseURL.includes("YOUR_PROJECT_ID")) {
                document.getElementById('configWarning').classList.remove('hidden');
                return;
            }
            
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.database();
                isConfigured = true;
                console.log("âœ… Firebase Connected");
            } catch (e) {
                console.error(e);
                showToast("Firebase ì—°ê²° ì‹¤íŒ¨. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.");
            }
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        initFirebase();

        // ==========================================
        // UI ì œì–´ í•¨ìˆ˜
        // ==========================================
        function setRole(role) {
            currentRole = role;
            const buttons = document.querySelectorAll('.role-tab');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (role === 'teacher') {
                buttons[0].classList.add('active');
                document.getElementById('teacherInput').classList.remove('hidden');
                document.getElementById('studentInput').classList.add('hidden');
                document.getElementById('pwInput').focus();
            } else {
                buttons[1].classList.add('active');
                document.getElementById('teacherInput').classList.add('hidden');
                document.getElementById('studentInput').classList.remove('hidden');
                document.getElementById('nickInput').focus();
            }
        }

        function handleEnter(e, callback) {
            if (e.key === 'Enter') callback();
        }

        function showToast(msg) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // ==========================================
        // ë¡œì§ í•¨ìˆ˜ (ë¡œê·¸ì¸/ì§ˆë¬¸/ë‹µë³€)
        // ==========================================
        function login() {
            if (!isConfigured) {
                showToast("âš ï¸ ì½”ë“œì—ì„œ Firebase ì„¤ì •ì„ ë¨¼ì € ì™„ë£Œí•´ì£¼ì„¸ìš”!");
                return;
            }

            if (currentRole === 'teacher') {
                const pw = document.getElementById('pwInput').value;
                if (pw === 'teacher1234') {
                    myName = 'ì„ ìƒë‹˜';
                    enterClassroom();
                } else {
                    showToast("âŒ ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                }
            } else {
                const nick = document.getElementById('nickInput').value.trim();
                if (nick) {
                    myName = nick;
                    // í•™ìƒ ë“±ë¡
                    db.ref('students/' + nick).set({
                        name: nick,
                        joinedAt: Date.now()
                    });
                    enterClassroom();
                } else {
                    showToast("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                }
            }
        }

        function enterClassroom() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');

            if (currentRole === 'teacher') {
                document.getElementById('teacherControls').classList.remove('hidden');
            } else {
                document.getElementById('studentControls').classList.remove('hidden');
            }

            // ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ì‹œì‘
            startListening();
            showToast(`ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤, ${myName}ë‹˜!`);
        }

        // ==========================================
        // ì‹¤ì‹œê°„ ë°ì´í„° ë¦¬ìŠ¤ë‹ & ë Œë”ë§
        // ==========================================
        function startListening() {
            // 1. ì„¤ì •ê°’ (í•™ìƒ ìˆ˜)
            db.ref('settings/totalStudents').on('value', snap => {
                const total = snap.val() || 0;
                document.getElementById('statTotal').textContent = total;
            });

            // 2. í˜„ì¬ ì§ˆë¬¸
            db.ref('currentQuestion').on('value', snap => {
                const data = snap.val();
                const chatWindow = document.getElementById('chatWindow');
                
                if (data && data.text) {
                    // ì±„íŒ…ì°½ ì´ˆê¸°í™”í•˜ê³  ì§ˆë¬¸ í‘œì‹œ
                    chatWindow.innerHTML = `
                        <div class="message msg-teacher">
                            <div class="sender">ğŸ“ ì„ ìƒë‹˜ì˜ ì§ˆë¬¸</div>
                            <div class="text">${data.text}</div>
                        </div>
                    `;
                    // ë‹µë³€ë“¤ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸° (trigger answers listener)
                }
            });

            // 3. ë‹µë³€ ëª©ë¡ (ì±„íŒ… ë²„ë¸” + ì›Œë“œí´ë¼ìš°ë“œ)
            db.ref('answers').on('value', snap => {
                const answersObj = snap.val();
                const chatWindow = document.getElementById('chatWindow');
                
                // ê¸°ì¡´ ë‹µë³€ë“¤ ì œê±° (ì§ˆë¬¸ì€ ìœ ì§€)
                const questionNode = chatWindow.querySelector('.msg-teacher');
                chatWindow.innerHTML = '';
                if (questionNode) chatWindow.appendChild(questionNode);
                else {
                     chatWindow.innerHTML = '<div style="text-align:center; margin-top:50px; color:#666;">ì§ˆë¬¸ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>';
                     return;
                }

                if (!answersObj) {
                    document.getElementById('statAnswered').textContent = 0;
                    renderWordCloud([]);
                    return;
                }

                const answers = Object.values(answersObj);
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                // ì¤‘ë³µ ë‹‰ë„¤ì„ ì œê±°í•˜ì—¬ ì¹´ìš´íŠ¸ (í•œ í•™ìƒì´ ì—¬ëŸ¬ë²ˆ ë³´ëƒˆì„ ê²½ìš° ëŒ€ë¹„, í˜„ì¬ ë¡œì§ì€ 1íšŒì§€ë§Œ)
                const uniqueStudents = new Set(answers.map(a => a.student));
                document.getElementById('statAnswered').textContent = uniqueStudents.size;

                // ì±„íŒ…ì°½ì— ë‹µë³€ ë Œë”ë§
                answers.forEach(ans => {
                    const isMe = ans.student === myName;
                    const bubble = document.createElement('div');
                    bubble.className = `message ${isMe ? 'msg-me' : 'msg-other'}`;
                    bubble.innerHTML = `
                        <div class="sender">${ans.student}</div>
                        <div class="text">${ans.text}</div>
                    `;
                    chatWindow.appendChild(bubble);
                });

                // ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ
                chatWindow.scrollTop = chatWindow.scrollHeight;

                // ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„±
                renderWordCloud(answers.map(a => a.text));
            });
        }

        // ==========================================
        // ì•¡ì…˜ í•¨ìˆ˜
        // ==========================================
        function setTotalCount() {
            const count = document.getElementById('totalStudentInput').value;
            if (count > 0) {
                db.ref('settings/totalStudents').set(parseInt(count));
                showToast("âœ… ì „ì²´ í•™ìƒ ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

        function sendQuestion() {
            const text = document.getElementById('questionInput').value.trim();
            if (!text) return;

            // ì´ì „ ë‹µë³€ë“¤ ì‚­ì œ (ìƒˆ ì§ˆë¬¸ ì‹œì‘)
            db.ref('answers').remove();
            
            // ì§ˆë¬¸ ë“±ë¡
            db.ref('currentQuestion').set({
                text: text,
                timestamp: Date.now()
            });

            document.getElementById('questionInput').value = '';
            showToast("ğŸ“¢ ì§ˆë¬¸ì„ ì „ì†¡í–ˆìŠµë‹ˆë‹¤!");
        }

        function sendAnswer() {
            const text = document.getElementById('answerInput').value.trim();
            if (!text) return;

            // ì¤‘ë³µ ë‹µë³€ ì²´í¬
            db.ref('answers').once('value', snap => {
                const answers = snap.val();
                let already = false;
                if (answers) {
                    already = Object.values(answers).some(a => a.student === myName);
                }

                if (already) {
                    showToast("âš ï¸ ì´ë¯¸ ë‹µë³€ì„ ì œì¶œí•˜ì…¨ìŠµë‹ˆë‹¤.");
                    return;
                }

                // ë‹µë³€ ì „ì†¡
                db.ref('answers').push({
                    student: myName,
                    text: text,
                    timestamp: Date.now()
                });
                
                document.getElementById('answerInput').value = '';
                showToast("âœ… ë‹µë³€ ì œì¶œ ì™„ë£Œ!");
            });
        }

        // ==========================================
        // â˜ï¸ ì›Œë“œ í´ë¼ìš°ë“œ ì•Œê³ ë¦¬ì¦˜ (ì—…ê·¸ë ˆì´ë“œë¨)
        // ==========================================
        function renderWordCloud(texts) {
            const container = document.getElementById('wordcloudContainer');
            container.innerHTML = '';

            if (!texts || texts.length === 0) {
                container.innerHTML = '<p style="color:#ccc;">ë‹µë³€ì´ ëª¨ì´ë©´ í‚¤ì›Œë“œê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>';
                return;
            }

            // 1. í…ìŠ¤íŠ¸ ì „ì²˜ë¦¬ ë° ë‹¨ì–´ ì¶”ì¶œ
            const allText = texts.join(' ');
            // íŠ¹ìˆ˜ë¬¸ì ì œê±° ë° ê³µë°± ê¸°ì¤€ ë¶„ë¦¬
            const words = allText.replace(/[.,?!'"\(\)]/g, '').split(/\s+/);
            
            // 2. ë¶ˆìš©ì–´(Stop words) í•„í„°ë§ (í•œêµ­ì–´ ì¡°ì‚¬ ë“± ê°„ë‹¨ ì²˜ë¦¬)
            const stopWords = ['ì€', 'ëŠ”', 'ì´', 'ê°€', 'ì„', 'ë¥¼', 'ì—', 'ì˜', 'ë„', 'ì €', 'ì œ', 'ë„¤', 'ì•„ë‹ˆìš”', 'ê²ƒ', 'ìˆ˜', 'ë“±'];
            
            const frequency = {};
            words.forEach(word => {
                if (word.length > 1 && !stopWords.includes(word)) { // 1ê¸€ì ì œì™¸
                    frequency[word] = (frequency[word] || 0) + 1;
                }
            });

            // 3. ì •ë ¬ ë° ìƒìœ„ í‚¤ì›Œë“œ ì¶”ì¶œ
            const sortedWords = Object.entries(frequency)
                .sort((a, b) => b[1] - a[1]) // ë¹ˆë„ìˆ˜ ë‚´ë¦¼ì°¨ìˆœ
                .slice(0, 20); // ìƒìœ„ 20ê°œë§Œ

            if (sortedWords.length === 0) {
                container.innerHTML = '<p style="color:#ccc;">ë¶„ì„í•  ìœ íš¨í•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // 4. í°íŠ¸ í¬ê¸° ì •ê·œí™” (ìµœëŒ€ê°’ ê¸°ì¤€)
            const maxFreq = sortedWords[0][1];
            
            // 5. DOM ìƒì„±
            const fragment = document.createDocumentFragment();
            const colors = ['#3c1e1e', '#5c3c1e', '#7c5c3c', '#d9480f', '#1e3c5c'];

            sortedWords.forEach(([word, count]) => {
                const span = document.createElement('span');
                span.textContent = word;
                span.className = 'wc-word';
                
                // í¬ê¸° ë“±ê¸‰ ê³„ì‚° (1~5ë‹¨ê³„)
                let sizeClass = 'size-1';
                const ratio = count / maxFreq;
                if (ratio > 0.8) sizeClass = 'size-5';
                else if (ratio > 0.6) sizeClass = 'size-4';
                else if (ratio > 0.4) sizeClass = 'size-3';
                else if (ratio > 0.2) sizeClass = 'size-2';
                
                span.classList.add(sizeClass);
                
                // ì•½ê°„ì˜ ëœë¤ íšŒì „ ë° ìƒ‰ìƒ
                const rotate = Math.random() * 10 - 5; // -5 ~ 5ë„ íšŒì „
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                span.style.transform = `rotate(${rotate}deg)`;
                if(sizeClass === 'size-1') span.style.color = '#aaa'; // ì‘ì€ê±´ íšŒìƒ‰
                
                // íˆ´íŒ íš¨ê³¼ (íƒ€ì´í‹€)
                span.title = `${count}íšŒ ì–¸ê¸‰ë¨`;

                fragment.appendChild(span);
            });

            container.appendChild(fragment);
        }
    </script>
</body>
</html>



